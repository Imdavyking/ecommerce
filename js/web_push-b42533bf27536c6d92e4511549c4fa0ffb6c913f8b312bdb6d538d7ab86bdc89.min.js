function ownKeys(t,e){var r,n=Object.keys(t);return Object.getOwnPropertySymbols&&(r=Object.getOwnPropertySymbols(t),e&&(r=r.filter(function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable})),n.push.apply(n,r)),n}function _objectSpread(t){for(var e=1;e<arguments.length;e++){var r=null!=arguments[e]?arguments[e]:{};e%2?ownKeys(Object(r),!0).forEach(function(e){_defineProperty(t,e,r[e])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):ownKeys(Object(r)).forEach(function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(r,e))})}return t}function _defineProperty(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function _readOnlyError(e){throw new TypeError('"'+e+'" is read-only')}function asyncGeneratorStep(e,t,r,n,o,c,i){try{var a=e[c](i),s=a.value}catch(e){return void r(e)}a.done?t(s):Promise.resolve(s).then(n,o)}function _asyncToGenerator(a){return function(){var e=this,i=arguments;return new Promise(function(t,r){var n=a.apply(e,i);function o(e){asyncGeneratorStep(n,t,r,o,c,"next",e)}function c(e){asyncGeneratorStep(n,t,r,o,c,"throw",e)}o(void 0)})}}var VAPID_KEYS={publicKey:document.querySelector("#vapid_publicKey").getAttribute("content")},ERROR_CONTAINER=document.querySelector(".error"),PUSHER=document.querySelector(".pusher"),PUSH_FORM=document.querySelector("#pushForm"),CHANGE_DISPLAY=function(e,t){e.style.display=t},cacheBuster=JSON.parse(document.querySelector("#cache-busting-images").innerText),URL_BASE64_TO_UINT8_ARRAY=function(e){var t=(e+"=".repeat((4-e.length%4)%4)).replace(/\-/g,"+").replace(/_/g,"/"),r=atob(t),n=new Uint8Array(r.length);return r.split("").forEach(function(e,t){return n[t]=r.charCodeAt(t)}),n};addEventListener("DOMContentLoaded",function(){try{document.querySelector("#use-push").addEventListener("click",function(e){var o=e.target;o.innerHTML;o.innerHTML="<img src='".concat(cacheBuster["/img/loading.gif"],"' id='loading_network'>"),"serviceWorker"in navigator&&Notification.requestPermission().then(_asyncToGenerator(regeneratorRuntime.mark(function e(){var t,r,n;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,navigator.serviceWorker.register("/sw.min.js",{scope:"/"});case 3:return t=e.sent,e.next=6,t.register.pushManager.subscribe({userVisibleOnly:!0,applicationServerKey:URL_BASE64_TO_UINT8_ARRAY(VAPID_KEYS.publicKey)});case 6:return r=e.sent,_readOnlyError("subscription"),r=_objectSpread(_objectSpread({},JSON.parse(JSON.stringify(r))),{},{csrfToken:document.querySelector("[id='csrf_token']").getAttribute("content")}),e.next=10,fetch("/api/push_notification?subscribe",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(r)});case 10:return n=e.sent,e.next=13,n.text();case 13:o.innerText=formerTextOfButton,e.next=18;break;case 16:e.prev=16,e.t0=e.catch(0);case 18:case"end":return e.stop()}},e,null,[[0,16]])})))})}catch(e){}}),PUSHER.addEventListener("click",function(i){return navigator.serviceWorker.getRegistration().then(function(){var t=_asyncToGenerator(regeneratorRuntime.mark(function e(t){var r,n,o,c;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=i.target,n=r.innerHTML,r.innerHTML="<img src='".concat(cacheBuster["/img/loading.gif"],"' id='loading_network'>"),e.prev=3,o={csrfToken:document.querySelector("[id='csrf_token']").getAttribute("content")},new FormData(PUSH_FORM).forEach(function(e,t){o[t]=e}),o.tag||(o.tag="msg"),e.next=9,fetch("/api/push_notification?sendPush",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(o)});case 9:return c=e.sent,e.next=12,c.json();case 12:e.sent.success?swal({title:"Success",text:"Push notification sent!",icon:"success"}):swal({title:"Error",text:"Push Notification could not be sent",icon:"error"}),r.innerHTML=n,e.next=24;break;case 17:e.prev=17,e.t0=e.catch(3),r.innerHTML=n,console.log(e.t0),CHANGE_DISPLAY(ERROR_CONTAINER,"block"),setTimeout(function(){return CHANGE_DISPLAY(ERROR_CONTAINER,"none")},3e3),ERROR_CONTAINER.innerText="Subscribe to push notification first";case 24:case"end":return e.stop()}},e,null,[[3,17]])}));return function(e){return t.apply(this,arguments)}}())}),PUSH_FORM.addEventListener("submit",function(e){return e.preventDefault()});